<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>CO&#x2082;</title>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		
		<link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,300' rel='stylesheet' type='text/css'>
		
		<style>
			/* CSS - Cascading Style Sheet */
			/* Palette color codes */
			/* Palette URL: http://paletton.com/#uid=30u0u0k7ziJ0Bv+2OoBg9equsem */

			/* Feel free to copy&paste color codes to your application */


			/* As hex codes */

			.color-primary-0 { color: #958272 }	/* Main Primary color */
			.color-primary-1 { color: #FFFCFA }
			.color-primary-2 { color: #C4BBB3 }
			.color-primary-3 { color: #735339 }
			.color-primary-4 { color: #723706 }

			.color-secondary-1-0 { color: #4F5564 }	/* Main Secondary color (1) */
			.color-secondary-1-1 { color: #A8A9AB }
			.color-secondary-1-2 { color: #797C83 }
			.color-secondary-1-3 { color: #2A354D }
			.color-secondary-1-4 { color: #0B1F4D }

			.color-secondary-2-0 { color: #5E795C }	/* Main Secondary color (2) */
			.color-secondary-2-1 { color: #CBCECB }
			.color-secondary-2-2 { color: #929F91 }
			.color-secondary-2-3 { color: #305D2E }
			.color-secondary-2-4 { color: #095D05 }



			/* As RGBa codes */

			.rgba-primary-0 { color: rgba(149,130,114,1) }	/* Main Primary color */
			.rgba-primary-1 { color: rgba(255,252,250,1) }
			.rgba-primary-2 { color: rgba(196,187,179,1) }
			.rgba-primary-3 { color: rgba(115, 83, 57,1) }
			.rgba-primary-4 { color: rgba(114, 55,  6,1) }

			.rgba-secondary-1-0 { color: rgba( 79, 85,100,1) }	/* Main Secondary color (1) */
			.rgba-secondary-1-1 { color: rgba(168,169,171,1) }
			.rgba-secondary-1-2 { color: rgba(121,124,131,1) }
			.rgba-secondary-1-3 { color: rgba( 42, 53, 77,1) }
			.rgba-secondary-1-4 { color: rgba( 11, 31, 77,1) }

			.rgba-secondary-2-0 { color: rgba( 94,121, 92,1) }	/* Main Secondary color (2) */
			.rgba-secondary-2-1 { color: rgba(203,206,203,1) }
			.rgba-secondary-2-2 { color: rgba(146,159,145,1) }
			.rgba-secondary-2-3 { color: rgba( 48, 93, 46,1) }
			.rgba-secondary-2-4 { color: rgba(  9, 93,  5,1) }



			/* Generated by Paletton.com Â© 2002-2014 */
			/* http://paletton.com */
			
			body {
				font-family: 'Roboto Slab', serif;
				background-color: rgba(115, 83, 57,1)
			}
			
			.section-background {
				fill: rgba(255,252,250,1);
				stroke: rgba(0,0,0,1);
				stroke-width: 3px;
			}
			
			.section-title {
				text-anchor: end;
				font-size: 16pt;
				text-decoration: underline;
			}
			
			.perspective-path {
				stroke: #000;
				fill: #666;
				fill-opacity: 0.25;
			}
			
			.kg {
				#fill: rgba(149,130,114,1);
			}
			
			.item {
				font-size: 10pt;
			}
			
			.item-right {
				text-anchor: end;
			}
			
			.cell {
				//shape-rendering: crispEdges;
				stroke: #000;
				stroke-width: 1px;
				stroke-dasharray: 20,20;
				stroke-dashoffset: 30;
				fill: rgba(121,124,131,1);
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-md-12 section" id="graphic"></div>
			</div>
		</div>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js"></script>
		<script src="waffle.js"></script>
		<script>
			$(function() {
				var data = { sections: [ { title: 'Kilograms', height: 300,
											fuels: [ { label: '1 gallon of unleaded gasoline', value: 8.91 },
													 { label: '1 gallon of diesel', value: 10.15 }
													]
										},
							 { title: 'Tonnes', height: 400 },
							 { title: 'Kilotonnes', height: 800 },
							 { title: 'Megatonnes', height: 300 },
							 { title: 'Gigatonnes', height: 300 }
				]};
				
				data.margin = 50;
				data.borderRadius = 20;
				data.height = d3.sum(data.sections, function(d) { return d.height; }) + data.margin*(data.sections.length+1);
				
				var offset = data.margin;
				data.sections.forEach(function(d, i, a) { 
					data.sections[i].offset = offset;
					offset += d.height + data.margin;
				});
				
				var svg = d3.select('#graphic')
							.append('svg')
							.attr('id', 'graphic-svg')
							.append('g');
							
				function scaleGraphic() {
					var width = $('#graphic').width();
					
					d3.select('#graphic-svg')
					  .attr('width', width)
					  .attr('height', Math.ceil(data.height * ((width-6)/800)));
					  
					d3.select('#graphic-svg g').attr('transform', 
									'translate(3,3) scale(' + ((width-6)/800) + ')');
				}
				scaleGraphic();
				window.addEventListener('resize', scaleGraphic, true);
								 
				var sections = svg.selectAll('.section')
								  .data(data.sections)
								  .enter()
								  .insert('g', ':first-child')
								  .classed('section', true)
								  .attr('transform', function(d, i) { return 'translate(0, ' + d.offset + ')'; });
								  
				sections.append('rect')
						.attr('id', function(d) { return d.title + '-background'; })
						.attr('x', 0)
						.attr('y', 0)
						.attr('width', 800)
						.attr('height', function(d) { return d.height; })
						.attr('rx', data.borderRadius)
						.attr('ry', data.borderRadius)
						.classed('section-background', true);
		
				// This adds the previous section shrunk to the appropriate size at the next scale.
				// The filter skips the first section, and the href attr references the previous
				// section because the indexes (i) get reset, meaning there's a shift and data[i]
				// actually refers to the previous item in the data array.
				var perspectives = sections.filter(function(d, i) { return i > 0; })
										   .append('g')
										   .classed('perspective', true);								
				
				perspectives.append('path')
							.classed('perspective-path', true)
							.attr('d', function(d, i) { 
								return 'M388,30 m-3,-3 h31 v' + (data.sections[i].height*0.0316+6) + ' h-31 z';
							});
								
				perspectives.append('path')
							.classed('perspective-path', true)
							.attr('d', function(d, i) {
								return 'M388,30 m-3,-3'
										+ ' L0,' + (data.sections[i].offset-d.offset+data.borderRadius)
										+ ' H800'
										+ ' L416,27';
							});
					
				perspectives.append('path')
							.classed('perspective-path', true)
							.attr('d', function(d, i) {
								return 'M388,30'
										+ ' m -3,' + (data.sections[i].height*0.0316+3)
										+ ' L' + data.borderRadius + ',-' + data.margin
										+ ' H' + (800-data.borderRadius)
										+ ' L416,' + (data.sections[i].height*0.0316+30+3);
							});
							
				sections = sections.append('g')
								   .attr('id', function(d) { return d.title; });

				var shrinks = sections.filter(function(d, i) { return i > 0; })
									  .append('g')
									  .attr('transform', 'translate(388,30) scale(0.0316)');
				
				shrinks.append('use')
					   .attr('xlink:href', function(d, i) { return '#' + data.sections[i].title + '-background'; });
					   
				shrinks.append('use')
					   .attr('xlink:href', function(d, i) { return '#' + data.sections[i].title; });
					   
				sections.append('text')
						.text(function(d) { return d.title; })
						.attr('x', 775)
						.attr('y', 30)
						.classed('section-title', true);
				
				/////////////// Kilograms ///////////////
				
				var kg = sections.filter('#Kilograms');
				
				var fuels = kg.append('g')
							  .attr('transform', 'translate(20,20)')
							  .selectAll('.fuel')
							  .data(data.sections[0].fuels)
							  .enter()
							  .append('g')
							  .classed('fuel', true)
							  .classed('item', true)
							  .classed('label-right', true)
							  .attr('transform', function(d, i) { return 'translate(0,' + (i*25) + ')'; });
							  
				fuels.append('text')
					 .text(function(d) { return d.label; });
					 
				fuels.append('g')
					 .selectAll('.cell')
					 .data(function(d) { return waffle.row()(d.value); })
					 .enter()
					 .append('rect')
					 .attr('x', function(d) { return d.x*12; })
					 .attr('y', 0)
					 .attr('width', 10)
					 .attr('height', 10)
					 .classed('cell', true)
					 ;
			});
		</script>
	</body>
</html>